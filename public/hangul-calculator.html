<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>한글 금액 계산기</title>
    <style>
      :root {
        color-scheme: dark;
        font-family: "Pretendard", "Noto Sans KR", system-ui, -apple-system, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: grid;
        place-items: center;
        background: #0f172a;
        padding: 24px 16px;
      }

      main {
        width: 100%;
        max-width: 420px;
      }

      .calculator {
        background: #0b1224;
        border-radius: 32px;
        padding: 24px;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.4);
      }

      header p {
        margin: 0;
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.3em;
        color: #94a3b8;
      }

      header h1 {
        margin: 8px 0 0;
        font-size: 24px;
        color: #ffffff;
      }

      .display {
        margin-top: 20px;
        background: #020617;
        border-radius: 20px;
        padding: 20px;
        text-align: right;
      }

      .display .value {
        font-size: 36px;
        font-weight: 600;
        color: #ffffff;
      }

      .display .hangul {
        margin-top: 8px;
        font-size: 14px;
        color: #94a3b8;
      }

      .copy-row {
        margin-top: 16px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .copy-row button {
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: transparent;
        color: #e2e8f0;
        padding: 10px 12px;
        border-radius: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: border 0.2s ease;
      }

      .copy-row button:hover {
        border-color: rgba(148, 163, 184, 0.7);
      }

      .copy-message {
        margin-top: 12px;
        text-align: center;
        font-size: 12px;
        color: #94a3b8;
        min-height: 16px;
      }

      .copy-message.active {
        color: #6ee7b7;
      }

      .keypad {
        margin-top: 24px;
        display: grid;
        gap: 12px;
      }

      .keypad-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 12px;
      }

      .keypad button {
        height: 60px;
        border-radius: 18px;
        border: none;
        font-size: 20px;
        font-weight: 600;
        color: #ffffff;
        background: #1e293b;
        cursor: pointer;
        transition: transform 0.1s ease;
      }

      .keypad button:active {
        transform: scale(0.97);
      }

      .keypad button.action {
        background: #334155;
      }

      .keypad button.equals {
        background: #34d399;
        color: #0f172a;
      }

      .keypad button.zero {
        grid-column: span 2;
      }
    </style>
  </head>
  <body>
    <main>
      <section class="calculator">
        <header>
          <p>Hangul Amount</p>
          <h1>한글 금액 계산기</h1>
        </header>

        <div class="display">
          <div class="value" data-display>0</div>
          <div class="hangul" data-hangul>영</div>
        </div>

        <div class="copy-row">
          <button type="button" data-copy="number">숫자 복사</button>
          <button type="button" data-copy="hangul">한글 복사</button>
        </div>
        <p class="copy-message" data-message>터치해서 복사하세요.</p>

        <div class="keypad" data-keypad>
          <div class="keypad-row">
            <button type="button" class="action" data-input="AC">AC</button>
            <button type="button" class="action" data-input="⌫">⌫</button>
            <button type="button" class="action" data-input="÷">÷</button>
            <span aria-hidden="true"></span>
          </div>
          <div class="keypad-row">
            <button type="button" data-input="7">7</button>
            <button type="button" data-input="8">8</button>
            <button type="button" data-input="9">9</button>
            <button type="button" class="action" data-input="×">×</button>
          </div>
          <div class="keypad-row">
            <button type="button" data-input="4">4</button>
            <button type="button" data-input="5">5</button>
            <button type="button" data-input="6">6</button>
            <button type="button" class="action" data-input="-">-</button>
          </div>
          <div class="keypad-row">
            <button type="button" data-input="1">1</button>
            <button type="button" data-input="2">2</button>
            <button type="button" data-input="3">3</button>
            <button type="button" class="action" data-input="+">+</button>
          </div>
          <div class="keypad-row">
            <button type="button" class="zero" data-input="0">0</button>
            <button type="button" data-input=".">.</button>
            <button type="button" class="equals" data-input="=">=</button>
          </div>
        </div>
      </section>
    </main>

    <script>
      const digitHangul = ["", "일", "이", "삼", "사", "오", "육", "칠", "팔", "구"];
      const smallUnits = ["", "십", "백", "천"];
      const largeUnits = ["", "만", "억", "조", "경"];

      const convertGroup = (group) => {
        let output = "";
        const padded = group.padStart(4, "0");

        for (let i = 0; i < 4; i += 1) {
          const digit = Number(padded[i]);
          if (digit === 0) {
            continue;
          }

          const unitIndex = 3 - i;
          const digitText = digit === 1 && unitIndex > 0 ? "" : digitHangul[digit];
          output += `${digitText}${smallUnits[unitIndex]}`;
        }

        return output;
      };

      const numberToHangul = (value) => {
        if (value === "Error") {
          return "오류";
        }

        if (value.includes(".")) {
          return "소수점 지원 예정";
        }

        const normalized = value.replace(/,/g, "").replace(/^0+(?!$)/, "");
        if (normalized === "" || normalized === "0") {
          return "영";
        }

        const isNegative = normalized.startsWith("-");
        const digits = isNegative ? normalized.slice(1) : normalized;
        const groups = [];

        for (let i = digits.length; i > 0; i -= 4) {
          groups.unshift(digits.slice(Math.max(0, i - 4), i));
        }

        const parts = [];
        groups.forEach((group, index) => {
          const converted = convertGroup(group);
          if (!converted) {
            return;
          }
          const unitIndex = groups.length - 1 - index;
          const unit = largeUnits[unitIndex] ?? "";
          parts.push(`${converted}${unit}`);
        });

        const joined = parts.join(" ");
        return isNegative ? `마이너스 ${joined}` : joined;
      };

      const initialState = {
        left: "0",
        operator: null,
        right: null,
        display: "0",
      };

      const isIntegerString = (value) => !value.includes(".");

      const normalizeNumberString = (value) => {
        if (value === "" || value === "-") {
          return "0";
        }
        return value;
      };

      const formatNumber = (value) => {
        if (value === "Error") {
          return value;
        }

        const isNegative = value.startsWith("-");
        const normalized = isNegative ? value.slice(1) : value;
        const [integer, decimal] = normalized.split(".");
        const formattedInteger = integer
          .replace(/^0+(?!$)/, "")
          .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        const withDecimal = decimal !== undefined ? `${formattedInteger}.${decimal}` : formattedInteger;

        return isNegative ? `-${withDecimal}` : withDecimal;
      };

      const compute = (left, right, operator) => {
        if (left === "" || right === "") {
          return left;
        }

        if (isIntegerString(left) && isIntegerString(right)) {
          const leftBig = BigInt(left);
          const rightBig = BigInt(right);

          if (operator === "+") {
            return (leftBig + rightBig).toString();
          }
          if (operator === "-") {
            return (leftBig - rightBig).toString();
          }
          if (operator === "×") {
            return (leftBig * rightBig).toString();
          }
          if (operator === "÷") {
            if (rightBig === 0n) {
              return "Error";
            }
            if (leftBig % rightBig === 0n) {
              return (leftBig / rightBig).toString();
            }
          }
        }

        const leftNum = Number(left);
        const rightNum = Number(right);

        if (!Number.isFinite(leftNum) || !Number.isFinite(rightNum)) {
          return "Error";
        }

        if (operator === "÷" && rightNum === 0) {
          return "Error";
        }

        const result =
          operator === "+"
            ? leftNum + rightNum
            : operator === "-"
            ? leftNum - rightNum
            : operator === "×"
            ? leftNum * rightNum
            : leftNum / rightNum;

        return result.toString();
      };

      const updateDisplay = (state) => {
        if (state.display === "Error") {
          return state;
        }

        const activeValue = state.right ?? state.left;
        return {
          ...state,
          display: formatNumber(normalizeNumberString(activeValue)),
        };
      };

      const resetIfError = (state) => {
        if (state.display === "Error") {
          return { ...initialState };
        }
        return state;
      };

      const appendDigit = (value, digit) => {
        if (value === "0" && digit !== ".") {
          return digit;
        }
        if (digit === ".") {
          if (value.includes(".")) {
            return value;
          }
          return value === "" ? "0." : `${value}.`;
        }
        return `${value}${digit}`;
      };

      const applyInput = (state, input) => {
        const safeState = resetIfError(state);

        if (input === "AC") {
          return { ...initialState };
        }

        if (input === "⌫") {
          if (safeState.right !== null) {
            const updated = safeState.right.slice(0, -1);
            return updateDisplay({
              ...safeState,
              right: updated.length ? updated : "0",
            });
          }

          const updated = safeState.left.slice(0, -1);
          return updateDisplay({
            ...safeState,
            left: updated.length ? updated : "0",
          });
        }

        if (input === "=") {
          if (safeState.operator && safeState.right !== null) {
            const result = compute(safeState.left, safeState.right, safeState.operator);
            const nextState = {
              left: result === "Error" ? "0" : result,
              operator: null,
              right: null,
              display: result,
            };

            return updateDisplay(nextState);
          }

          return updateDisplay(safeState);
        }

        if (["+", "-", "×", "÷"].includes(input)) {
          const op = input;
          if (safeState.operator && safeState.right !== null) {
            const result = compute(safeState.left, safeState.right, safeState.operator);
            return updateDisplay({
              left: result === "Error" ? "0" : result,
              operator: op,
              right: null,
              display: result,
            });
          }

          return updateDisplay({
            ...safeState,
            operator: op,
            right: null,
          });
        }

        if (/^\d$/.test(input) || input === ".") {
          if (safeState.operator) {
            const nextRight = appendDigit(safeState.right ?? "", input);
            return updateDisplay({
              ...safeState,
              right: nextRight,
            });
          }

          const nextLeft = appendDigit(safeState.left, input);
          return updateDisplay({
            ...safeState,
            left: nextLeft,
          });
        }

        return updateDisplay(safeState);
      };

      const displayEl = document.querySelector("[data-display]");
      const hangulEl = document.querySelector("[data-hangul]");
      const messageEl = document.querySelector("[data-message]");
      const keypad = document.querySelector("[data-keypad]");
      const copyButtons = document.querySelectorAll("[data-copy]");

      let state = { ...initialState };

      const render = () => {
        displayEl.textContent = formatNumber(state.display === "Error" ? "Error" : state.display);
        hangulEl.textContent = numberToHangul(state.display);
      };

      const showMessage = (text, isSuccess) => {
        messageEl.textContent = text;
        messageEl.classList.toggle("active", isSuccess);
        clearTimeout(messageEl._timer);
        messageEl._timer = setTimeout(() => {
          messageEl.textContent = "터치해서 복사하세요.";
          messageEl.classList.remove("active");
        }, 1800);
      };

      keypad.addEventListener("click", (event) => {
        const button = event.target.closest("button");
        if (!button) {
          return;
        }
        const input = button.dataset.input;
        if (!input) {
          return;
        }
        state = applyInput(state, input);
        render();
      });

      copyButtons.forEach((button) => {
        button.addEventListener("click", async () => {
          const type = button.dataset.copy;
          const text = type === "number" ? displayEl.textContent : hangulEl.textContent;
          try {
            await navigator.clipboard.writeText(text);
            showMessage(type === "number" ? "숫자를 복사했어요." : "한글 금액을 복사했어요.", true);
          } catch (error) {
            console.error(error);
            showMessage("복사에 실패했어요.", false);
          }
        });
      });

      render();
    </script>
  </body>
</html>
